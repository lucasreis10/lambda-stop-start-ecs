{"AWSTemplateFormatVersion":"2010-09-09","Description":"The AWS CloudFormation template for this Serverless application","Resources":{"ServerlessDeploymentBucket":{"Type":"AWS::S3::Bucket","Properties":{"BucketEncryption":{"ServerSideEncryptionConfiguration":[{"ServerSideEncryptionByDefault":{"SSEAlgorithm":"AES256"}}]}}},"ServerlessDeploymentBucketPolicy":{"Type":"AWS::S3::BucketPolicy","Properties":{"Bucket":{"Ref":"ServerlessDeploymentBucket"},"PolicyDocument":{"Statement":[{"Action":"s3:*","Effect":"Deny","Principal":"*","Resource":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":s3:::",{"Ref":"ServerlessDeploymentBucket"},"/*"]]},{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":s3:::",{"Ref":"ServerlessDeploymentBucket"}]]}],"Condition":{"Bool":{"aws:SecureTransport":false}}}]}}},"AppLogGroup":{"Type":"AWS::Logs::LogGroup","Properties":{"LogGroupName":"/aws/lambda/serverless-nodejs-app-dev-app"}},"IamRoleLambdaExecution":{"Type":"AWS::IAM::Role","Properties":{"AssumeRolePolicyDocument":{"Version":"2012-10-17","Statement":[{"Effect":"Allow","Principal":{"Service":["lambda.amazonaws.com"]},"Action":["sts:AssumeRole"]}]},"Policies":[{"PolicyName":{"Fn::Join":["-",["serverless-nodejs-app","dev","lambda"]]},"PolicyDocument":{"Version":"2012-10-17","Statement":[{"Effect":"Allow","Action":["logs:CreateLogStream","logs:CreateLogGroup","logs:TagResource"],"Resource":[{"Fn::Sub":"arn:${AWS::Partition}:logs:${AWS::Region}:${AWS::AccountId}:log-group:/aws/lambda/serverless-nodejs-app-dev*:*"}]},{"Effect":"Allow","Action":["logs:PutLogEvents"],"Resource":[{"Fn::Sub":"arn:${AWS::Partition}:logs:${AWS::Region}:${AWS::AccountId}:log-group:/aws/lambda/serverless-nodejs-app-dev*:*:*"}]}]}}],"Path":"/","RoleName":{"Fn::Join":["-",["serverless-nodejs-app","dev",{"Ref":"AWS::Region"},"lambdaRole"]]}}},"AppLambdaFunction":{"Type":"AWS::Lambda::Function","Properties":{"Code":{"S3Bucket":{"Ref":"ServerlessDeploymentBucket"},"S3Key":"serverless/serverless-nodejs-app/dev/1688763886217-2023-07-07T21:04:46.217Z/serverless-nodejs-app.zip"},"Handler":"app.handler","Runtime":"nodejs14.x","FunctionName":"serverless-nodejs-app-dev-app","MemorySize":1024,"Timeout":6,"Role":{"Fn::GetAtt":["IamRoleLambdaExecution","Arn"]}},"DependsOn":["AppLogGroup"]},"AppLambdaVersionv1LkTqe7B1LfsQfFd2KHzHfBMPuKxXJyQ6F2u5kr6QU":{"Type":"AWS::Lambda::Version","DeletionPolicy":"Retain","Properties":{"FunctionName":{"Ref":"AppLambdaFunction"},"CodeSha256":"c6TqLmqNPqZESyGJvRBYPLhxWxEi3pMSQ/BK80uQXlY="}},"AppEventsRuleSchedule1":{"Type":"AWS::Events::Rule","Properties":{"ScheduleExpression":"cron(0/3 * * * ? *)","State":"ENABLED","Targets":[{"Input":"{\"task\":\"srv\",\"cluster\":\"node-api\",\"action\":\"start\"}","Arn":{"Fn::GetAtt":["AppLambdaFunction","Arn"]},"Id":"appSchedule"}]}},"AppLambdaPermissionEventsRuleSchedule1":{"Type":"AWS::Lambda::Permission","Properties":{"FunctionName":{"Fn::GetAtt":["AppLambdaFunction","Arn"]},"Action":"lambda:InvokeFunction","Principal":"events.amazonaws.com","SourceArn":{"Fn::GetAtt":["AppEventsRuleSchedule1","Arn"]}}}},"Outputs":{"ServerlessDeploymentBucketName":{"Value":{"Ref":"ServerlessDeploymentBucket"},"Export":{"Name":"sls-serverless-nodejs-app-dev-ServerlessDeploymentBucketName"}},"AppLambdaFunctionQualifiedArn":{"Description":"Current Lambda function version","Value":{"Ref":"AppLambdaVersionv1LkTqe7B1LfsQfFd2KHzHfBMPuKxXJyQ6F2u5kr6QU"},"Export":{"Name":"sls-serverless-nodejs-app-dev-AppLambdaFunctionQualifiedArn"}}}}